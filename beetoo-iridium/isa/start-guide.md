### Инструкция по сборке проекта под **IRIDIUM**.

Пользователям Windows рекомендуется установить Git Credential Manager for Windows v1.12.0  
[https://github.com/Microsoft/Git-Credential-Manager-for-Windows/releases](https://github.com/Microsoft/Git-Credential-Manager-for-Windows/releases)

#### Первая сборка проекта.

1. Перед началом работы над проектом необходимо скачать репозиторий на компьютер. В корневой папке всех проектов выполнить команду -  
    `$ git clone https://bitbucket.org/beetoo/150408_luzhniki`  
   \(для проекта Лужники\).  
   В корневой папке появится папка 150408\_luzhniki.

2. Перейти в папку проекта.  
    `$ cd 150408_luzhniki`

3. Файлы интерфесов Iridium под разные панели находятся в папке _**./gui**_.  
   Для проекта Лужники родительским проектом всех интерфейсов является проект  **ipad**.  
   Для проекта Жуковка родительским проектом всех интерфейсов является проект **pool1**.

4. Сборка родительского проекта. Перейти в папку _**./ipad**_ и для установки требуемых npm пакетов выполнить команду -  
    `$ npm install`

5. Все исходные файлы проекта \(**fonts, icons, images, scripts, sounds, templates**\) находятся в папке _**./src**_.

6. Сборка **dev** версии проекта.   
   В папке _**./ipad**_ выполнить команду -  
      `$ grunt --target=dev`

   Выполнится сборка всех исходников в один **Iridium** файл с расширением _**\*.irpz**_, который появится в папке _**./build**_.

7. Проверить работу **.irpz** файла в редакторе и эмуляторе **Iridium**.

#### Редактирование проекта.

1. При необходимости можно править файлы исходников проекта \(см. п.5 Первая сборка проекта\).

   * Файлы скриптов **js** лежат в папке _**./src/scripts**_.

   * Шрифты и изображения в папках _**./src/fonts, images.**_

   * Системные файлы, согласно структуре файла **irpz** лежат в файлах-шаблонах **\*.def** в папке _**./src/templates**_.

   * Дерево папок **irpz** в _**./src/templates/folders**_
   * Дерево устройств в _**./src/templates/devices, devicestree, universaltree**_
   * Списки шрифтов, иконок и картинок в _**./src/templates/fonts, icons, images**_
   * Настройки связей и переменные в _**./src/templates/relations, tokens**_

   * Графическая структура **irpz** описывается кодом **xml** в файле _**./src/templates/popups.def**_ или разбивается на отдельные **\*.def** файлы, согласно помещениям -  
     _**./src/templates/pool, barbershop, bedroom1, bathroom1 и т.д.**_

2. Также изменения в графическую часть **irpz** можно вносить с помощью программы **Iridium GUI Editor**. После сменить расширение **\*.irpz** на **\*.zip**, распаковать и перенести составляющие кода файла **Project.irp** в соответствующие файлы-шаблоны **\*.def**.

3. Сборка проекта см. п.6 Первая сборка проекта.

4. После успешного тестирования сборка **production** версии проекта командой -   
    `$ grunt concrete`  
   **!!! Перед сборкой необходимо увеличить версию проекта в файле package.json, а также убедиться в наличии файла concretecreds.json и актуальных данных в полях production\_license, salt, ssh, hwid**.

Сборка дочерних интерфейсов согласно пункту 4 Первая сборка проекта, но в соответствующих папках **\(iphone, mini, wallpc\)**. Перед сборкой необходимо файл **package.json** родительского проекта **ipad** скопировать в папку _**./node\_modules/Luzhniki-ipad**_ дочернего проекта.



#### Пример работы над интерфейсом.

##### Добавить страницу \(popup\) в интерфейс.

    Открываем собранный файл **\*.irpz** в редакторе **IRIDIUM**. Если создаваемая страница будет похожа на одну из существующих, то можно сначала сделать дубликат исходной и, далее, в новой править элементы, названия и другие атрибуты. Т.е. средствами редактора подготавливаем вид и функциональность новой страницы.

    Например, добавляем страницу _**kitchen\_main\_popup,**_ как похожий экземпляр существующей страницы _**livingroom\_main\_popup. **_Вносим правки_. _Сохраняем проект \***.irpz. **Далее, необходимо новые исходные составляющие проекта в файле **Project.irp** перенести в исходный код в нашем репозитории \(см .п. 1,2 Редактирование проекта\) и в самом коде **js** добавить поддержку новой страницы. А именно:

* подключить новую страницу в коде файла _**./src/scripts/Ifaces.js** _в структуру работы слоев \(**layout**\) интерфейса по примеру существующих_._
* добавить весь функциональный код работы мультимедиа сценариев, световых сцен, инженерных систем по примеру кода файлов _**livingroom\*\*\*.js**_** **во вновь созданные файлы** **_**kitchen\*\*\*.js.**_
* названия новых **js** файлов добавить в список скриптов в файле_** ./src/irgui.json. **_

После произвести тестовую сборку проекта.     **   **  



